#!/bin/bash
s3url="$1"

cd "$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/.."

LBLUE='\033[1;34m'
GREEN='\033[0;32m'
RED='\033[0;31m'
DARKGREY='\033[1;30m'
NC='\033[0m'

function section {
  echo -e "\n$LBLUE--- $1$DARKGREY"
}


if [[ "$s3url" == "" ]]; then
  echo -e "\nUsage: ./deployAssets <s3://mydomain.com/mybucket/>"
  exit 1
fi


bin/makeAssets
if [[ $? == 1 ]]; then
  echo -e "\n$RED--- Couldn't make assets to deploy$NC"
  exit 1
fi


section "Sending assets to $s3url"
cd tmp/production_assets &&
find . -mindepth 1 -exec aws s3 cp "{}" "$s3url" --acl public-read \;


echo -e "$NC\ndone deploying assets.\n"
