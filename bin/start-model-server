#!/bin/bash
args=$@
bindir=`realpath "$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"`
toolsdir="$bindir/../tools"

export pidfile="$bindir/../../model-server.pid"
function finish {
    res=$?
    rm -f "$pidfile"
    echo "model-server out"
    exit $res
}
trap finish EXIT INT TERM

cd "$toolsdir/js"
if ! ret=$(npm install 2>&1) ; then echo "$ret" ; fi

cd "$bindir/.."
node "$toolsdir/js/mains/model-server.js" $args &
child=$!
echo $child > "$pidfile"
wait $child